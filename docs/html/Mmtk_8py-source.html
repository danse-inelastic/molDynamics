<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>molDynamics: molDynamics/mmtk/Mmtk.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_0fe97e93304435d2463c2ea1c1e66b1b.html">molDynamics</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_95609391427dc14819e4fb99fa889495.html">mmtk</a></div>
<h1>Mmtk.py</h1><a href="Mmtk_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacemolDynamics_1_1mmtk_1_1Mmtk.html">00001</a> <span class="comment">#!/usr/bin/env python</span>
<a name="l00002"></a>00002 <span class="comment"># =================================================================</span>
<a name="l00003"></a>00003 <span class="comment">#</span>
<a name="l00004"></a>00004 <span class="comment"># {LicenseText}</span>
<a name="l00005"></a>00005 <span class="comment">#</span>
<a name="l00006"></a>00006 <span class="comment"># =================================================================</span>
<a name="l00007"></a>00007 <span class="comment">#</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="keyword">from</span> molDynamics.MolDynamics <span class="keyword">import</span> MolDynamics
<a name="l00010"></a>00010 <span class="keyword">import</span> math
<a name="l00011"></a>00011 <span class="keyword">import</span> MMTK
<a name="l00012"></a>00012 <span class="keyword">from</span> MMTK <span class="keyword">import</span> Units
<a name="l00013"></a>00013 <span class="keyword">from</span> MMTK.ForceFields <span class="keyword">import</span> LennardJonesForceField, Amber94ForceField
<a name="l00014"></a>00014 <span class="keyword">from</span> MMTK.Environment <span class="keyword">import</span> NoseThermostat, AndersenBarostat
<a name="l00015"></a>00015 <span class="keyword">from</span> MMTK.Trajectory <span class="keyword">import</span> Trajectory, TrajectoryOutput, LogOutput, RestartTrajectoryOutput
<a name="l00016"></a>00016 <span class="keyword">from</span> MMTK.Dynamics <span class="keyword">import</span> VelocityVerletIntegrator, VelocityScaler, \
<a name="l00017"></a>00017                           TranslationRemover, RotationRemover,BarostatReset
<a name="l00018"></a>00018 <span class="keyword">from</span> os <span class="keyword">import</span> linesep
<a name="l00019"></a>00019   
<a name="l00020"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html">00020</a> <span class="keyword">class </span><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html">Mmtk</a>(<a class="code" href="classmolDynamics_1_1MolDynamics_1_1MolDynamics.html">MolDynamics</a>):
<a name="l00021"></a>00021     <span class="stringliteral">"""MMTK functionality usable in DANSE.</span>
<a name="l00022"></a>00022 <span class="stringliteral">    </span>
<a name="l00023"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk_1_1Inventory.html">00023</a> <span class="stringliteral">This class maps the API to MMTK commands and executes them."""</span>
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk_1_1Inventory.html#bfacccd5a29a2e19aed840c291bc175c">00025</a>     <span class="keyword">class </span><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk_1_1Inventory.html">Inventory</a>(<a class="code" href="classmolDynamics_1_1MolDynamics_1_1MolDynamics.html">MolDynamics</a>.Inventory):
<a name="l00026"></a>00026         <span class="keyword">import</span> pyre.inventory <span class="keyword">as</span> inv 
<a name="l00027"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk_1_1Inventory.html#3f2d6bea5a1b83db5d1d162b683ef21a">00027</a>         integrator = inv.str(<span class="stringliteral">'Integrator'</span>, default = <span class="stringliteral">'velocity-verlet'</span>)
<a name="l00028"></a>00028         integrator.meta[<span class="stringliteral">'tip'</span>] = <span class="stringliteral">'type of integrator'</span>
<a name="l00029"></a>00029         runType = inv.str(<span class="stringliteral">'Run Type'</span>, default = <span class="stringliteral">'md'</span>)
<a name="l00030"></a>00030         runType.validator=inv.choice([<span class="stringliteral">'md'</span>, <span class="stringliteral">'restart md'</span>])
<a name="l00031"></a>00031         runType.meta[<span class="stringliteral">'tip'</span>] = <span class="stringliteral">'type of run'</span>
<a name="l00032"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#64cad0ebcee8ebf77c45f0c089ed797a">00032</a>         runType.meta[<span class="stringliteral">'importance'</span>] = 9
<a name="l00033"></a>00033 
<a name="l00034"></a>00034     <span class="keyword">def </span><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#64cad0ebcee8ebf77c45f0c089ed797a">__init__</a>(self, name='mmtk'):
<a name="l00035"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">00035</a>         MolDynamics.__init__(self, name, facility=<span class="stringliteral">'mdEngine'</span>)
<a name="l00036"></a>00036         self._setDefaults()
<a name="l00037"></a>00037         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse = <span class="keywordtype">None</span>
<a name="l00038"></a>00038         
<a name="l00039"></a>00039     <span class="keyword">def </span>printWarnings(self):
<a name="l00040"></a>00040         <span class="stringliteral">'''print warnings if the user chooses settings which are incorrect'''</span>
<a name="l00041"></a>00041         <span class="keywordflow">pass</span>
<a name="l00042"></a>00042         
<a name="l00043"></a>00043     <span class="keyword">def </span>_setDefaults(self):
<a name="l00044"></a>00044         <span class="stringliteral">'''set defaults specific to mmtk'''</span>
<a name="l00045"></a>00045         self.i.trajectoryFilename = <span class="stringliteral">'molDynamics.nc'</span>
<a name="l00046"></a>00046         self.i.restartFilename = <span class="stringliteral">'restart.nc'</span>
<a name="l00047"></a>00047         self.i.sampleFrequency = self.i.timeStep*Units.fs
<a name="l00048"></a>00048         self.i.dumpFrequency = self.i.timeStep*Units.fs
<a name="l00049"></a>00049         
<a name="l00050"></a>00050     <span class="keyword">def </span>_norm(self,vec):
<a name="l00051"></a>00051         <span class="stringliteral">"""gives the Euclidean _norm of a list"""</span>
<a name="l00052"></a>00052         temp=sum([el**2. <span class="keywordflow">for</span> el <span class="keywordflow">in</span> vec])
<a name="l00053"></a>00053         <span class="keywordflow">return</span> math.sqrt(temp)
<a name="l00054"></a>00054         
<a name="l00055"></a>00055     <span class="keyword">def </span>_ind(self,list):
<a name="l00056"></a>00056         <span class="stringliteral">"""gives the indices of the list to iterate over"""</span>
<a name="l00057"></a>00057         <span class="keywordflow">return</span> range(len(list))
<a name="l00058"></a>00058         
<a name="l00059"></a>00059     <span class="keyword">def </span>_dot(self,v1,v2):
<a name="l00060"></a>00060         <span class="stringliteral">"""returns the _dot product of v1 and v2"""</span>
<a name="l00061"></a>00061         <span class="keywordflow">return</span> sum([v1[i]*v2[i] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> self._ind(v1)])
<a name="l00062"></a>00062         
<a name="l00063"></a>00063     <span class="keyword">def </span>_vecsToParams(self,vecs):
<a name="l00064"></a>00064         <span class="stringliteral">"""takes lattice vectors in cartesian coordinates with origin at {0,0,0}</span>
<a name="l00065"></a>00065 <span class="stringliteral">        and returns lattice parameters"""</span>
<a name="l00066"></a>00066         conv=math.pi/180
<a name="l00067"></a>00067         [a,b,c]=vecs
<a name="l00068"></a>00068         ma=math.sqrt(self._dot(a,a))
<a name="l00069"></a>00069         mb=math.sqrt(self._dot(b,b))
<a name="l00070"></a>00070         mc=math.sqrt(self._dot(c,c))
<a name="l00071"></a>00071         al=1/conv*math.acos(self._dot(b,c)/mb/mc)
<a name="l00072"></a>00072         be=1/conv*math.acos(self._dot(a,c)/ma/mc)
<a name="l00073"></a>00073         ga=1/conv*math.acos(self._dot(a,b)/ma/mb)
<a name="l00074"></a>00074         <span class="keywordflow">return</span> [ma, mb, mc, al, be, ga]
<a name="l00075"></a>00075     
<a name="l00076"></a>00076     <span class="keyword">def </span>appEqual(self,v1,v2):
<a name="l00077"></a>00077         <span class="stringliteral">'''equal to within a certain numerical accuracy'''</span>
<a name="l00078"></a>00078         <span class="keywordflow">if</span> v1-v2&lt;10**-6:
<a name="l00079"></a>00079             <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l00080"></a>00080         <span class="keywordflow">else</span>:
<a name="l00081"></a>00081             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l00082"></a>00082         
<a name="l00083"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#2ec9871ac17d8b5466ddb8fddba66c83">00083</a>     <span class="keyword">def </span>_setForcefield(self):
<a name="l00084"></a>00084         <span class="stringliteral">'''This function sets the forcefield.'''</span>
<a name="l00085"></a>00085         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#2ec9871ac17d8b5466ddb8fddba66c83">ff</a>ff=self.i.forcefields.getForcefield()
<a name="l00086"></a>00086         
<a name="l00087"></a>00087     <span class="keyword">def </span>_setInitialConditions(self):
<a name="l00088"></a>00088         <span class="stringliteral">'''map MolDynamics unit cell stuff to MMTK's. </span>
<a name="l00089"></a>00089 <span class="stringliteral">        Eventually much of this will be taken by the crystal class'''</span> 
<a name="l00090"></a>00090         atoms = self.i.sample.i.atomicStructure.i.atoms
<a name="l00091"></a>00091         uc = self.i.sample.i.atomicStructure.i.unitCell.getCellVectors()
<a name="l00092"></a>00092         <span class="keywordflow">if</span> uc==<span class="keywordtype">None</span>:
<a name="l00093"></a>00093             self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse = MMTK.InfiniteUniverse(self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#2ec9871ac17d8b5466ddb8fddba66c83">ff</a>ff)
<a name="l00094"></a>00094         <span class="keywordflow">else</span>:
<a name="l00095"></a>00095             ucList=uc.tolist()
<a name="l00096"></a>00096             (a,b,c,al,be,ga)=self._vecsToParams(ucList)
<a name="l00097"></a>00097             <span class="keywordflow">if</span> self.appEqual(al, 90.0) <span class="keywordflow">and</span> self.appEqual(be, 90.0) <span class="keywordflow">and</span> self.appEqual(ga, 90.0):
<a name="l00098"></a>00098                 <span class="keywordflow">if</span> a==b <span class="keywordflow">and</span> b==c:
<a name="l00099"></a>00099                     self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse=MMTK.CubicPeriodicUniverse(a*Units.Ang, self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#2ec9871ac17d8b5466ddb8fddba66c83">ff</a>ff)
<a name="l00100"></a>00100                 <span class="keywordflow">else</span>:
<a name="l00101"></a>00101                     self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse=MMTK.OrthorhombicPeriodicUniverse(
<a name="l00102"></a>00102                             (a*Units.Ang, b*Units.Ang, c*Units.Ang), self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#2ec9871ac17d8b5466ddb8fddba66c83">ff</a>ff)
<a name="l00103"></a>00103             <span class="keywordflow">else</span>:
<a name="l00104"></a>00104                 uc=self.i.sample.unitCell
<a name="l00105"></a>00105                 self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse=MMTK.ParallelepipedicPeriodicUniverse(
<a name="l00106"></a>00106                     ((uc[0][0]*Units.Ang, uc[0][1]*Units.Ang, uc[0][2]*Units.Ang),
<a name="l00107"></a>00107                      (uc[1][0]*Units.Ang, uc[1][1]*Units.Ang, uc[1][2]*Units.Ang),
<a name="l00108"></a>00108                      (uc[2][0]*Units.Ang, uc[2][1]*Units.Ang, uc[2][2]*Units.Ang)), self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#2ec9871ac17d8b5466ddb8fddba66c83">ff</a>ff)
<a name="l00109"></a>00109         <span class="comment">#add objects to mmtkUniverse</span>
<a name="l00110"></a>00110         atomsOnly=atoms.split(linesep)[:-1]
<a name="l00111"></a>00111         <span class="keywordflow">for</span> atom <span class="keywordflow">in</span> atomsOnly:
<a name="l00112"></a>00112             species, x, y, z = atom.split()
<a name="l00113"></a>00113             self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse.addObject(MMTK.Atom(species, position = \
<a name="l00114"></a>00114                 MMTK.Vector(float(x)*Units.Ang, float(y)*Units.Ang, float(z)*Units.Ang))) 
<a name="l00115"></a>00115 <span class="comment">#        elif self.i.sample.has_attribute('molecule'):</span>
<a name="l00116"></a>00116 <span class="comment">#            pass</span>
<a name="l00117"></a>00117         
<a name="l00118"></a>00118     <span class="keyword">def </span>createTrajectoryAndIntegrator(self):
<a name="l00119"></a>00119         <span class="stringliteral">'''create trajectory and integrator'''</span>
<a name="l00120"></a>00120         <span class="comment">#initialize velocities--this has to happen after adding atoms</span>
<a name="l00121"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#0b6bfd208e225967d4e45f1df86857a5">00121</a>         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse.initializeVelocitiesToTemperature(self.i.sample.i.initialTemp)
<a name="l00122"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#5acab80c68beb2a2eaf7a01421a9789d">00122</a>         <span class="comment"># Create trajectory and integrator.</span>
<a name="l00123"></a>00123         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#0b6bfd208e225967d4e45f1df86857a5">mmtkTrajectory</a>mmtkTrajectory = Trajectory(self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse, self.i.trajectoryFilename, <span class="stringliteral">"w"</span>)
<a name="l00124"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#15865427ee798c1993cdd2f52aa37daf">00124</a>         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#5acab80c68beb2a2eaf7a01421a9789d">mmtkIntegrator</a>mmtkIntegrator = VelocityVerletIntegrator(self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse, delta_t=self.i.timeStep*Units.fs)
<a name="l00125"></a>00125         <span class="comment"># Periodical actions for equilibration output.</span>
<a name="l00126"></a>00126         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#15865427ee798c1993cdd2f52aa37daf">equilibration_actions</a>equilibration_actions = [TranslationRemover(0, <span class="keywordtype">None</span>, 100),
<a name="l00127"></a>00127             RotationRemover(0, <span class="keywordtype">None</span>, 100),
<a name="l00128"></a>00128             LogOutput(self.i.logFilename, (<span class="stringliteral">'time'</span>, <span class="stringliteral">'energy'</span>), 0, <span class="keywordtype">None</span>)
<a name="l00129"></a><a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#40a46385f55982f9e0039022bdd2482a">00129</a>             ]  
<a name="l00130"></a>00130         <span class="comment"># Periodical actions for trajectory output and text log output.</span>
<a name="l00131"></a>00131         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#40a46385f55982f9e0039022bdd2482a">output_actions</a>output_actions = [TrajectoryOutput(self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#0b6bfd208e225967d4e45f1df86857a5">mmtkTrajectory</a>mmtkTrajectory,
<a name="l00132"></a>00132             (<span class="stringliteral">'configuration'</span>, <span class="stringliteral">'energy'</span>, <span class="stringliteral">'thermodynamic'</span>, <span class="stringliteral">'time'</span>, <span class="stringliteral">'auxiliary'</span>), 
<a name="l00133"></a>00133             0, <span class="keywordtype">None</span>, 20), <span class="comment">#TODO: Fixme so the user can specify when trajectory and sample frequency happens</span>
<a name="l00134"></a>00134             <span class="comment">#this last option makes it so none of the equilibration steps are output, consistent with Gulp</span>
<a name="l00135"></a>00135             LogOutput(self.i.logFilename, (<span class="stringliteral">'time'</span>, <span class="stringliteral">'energy'</span>), 0, <span class="keywordtype">None</span>, 20) <span class="comment">#this last 0 makes it so all equilibration steps are output, consistent with Gulp</span>
<a name="l00136"></a>00136             ]         
<a name="l00137"></a>00137     
<a name="l00138"></a>00138     <span class="keyword">def </span>createRestartTrajectoryAndIntegrator(self):
<a name="l00139"></a>00139         <span class="stringliteral">'''initialize system from previous trajectory'''</span>
<a name="l00140"></a>00140         <span class="comment"># Initialize system state from the restart trajectory</span>
<a name="l00141"></a>00141         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse.setFromTrajectory(Trajectory(self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse, self.i.restartFilename))
<a name="l00142"></a>00142         <span class="comment"># Create trajectory and integrator.</span>
<a name="l00143"></a>00143         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#0b6bfd208e225967d4e45f1df86857a5">mmtkTrajectory</a>mmtkTrajectory = Trajectory(self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse, self.i.trajectoryFilename, <span class="stringliteral">"a"</span>)
<a name="l00144"></a>00144         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#5acab80c68beb2a2eaf7a01421a9789d">mmtkIntegrator</a>mmtkIntegrator = VelocityVerletIntegrator(self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse, delta_t=self.i.timestep*Units.fs)
<a name="l00145"></a>00145         <span class="comment"># Periodical actions for equilibration output.</span>
<a name="l00146"></a>00146         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#15865427ee798c1993cdd2f52aa37daf">equilibration_actions</a>equilibration_actions = [TranslationRemover(0, <span class="keywordtype">None</span>, 100),
<a name="l00147"></a>00147             RotationRemover(0, <span class="keywordtype">None</span>, 100),
<a name="l00148"></a>00148             LogOutput(self.i.logFilename, (<span class="stringliteral">'time'</span>, <span class="stringliteral">'energy'</span>), 0, <span class="keywordtype">None</span>)
<a name="l00149"></a>00149             ]  
<a name="l00150"></a>00150         <span class="comment"># Periodical actions for trajectory output and text log output.</span>
<a name="l00151"></a>00151         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#40a46385f55982f9e0039022bdd2482a">output_actions</a>output_actions = [TranslationRemover(0, <span class="keywordtype">None</span>, 100),
<a name="l00152"></a>00152                                TrajectoryOutput(self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#0b6bfd208e225967d4e45f1df86857a5">mmtkTrajectory</a>mmtkTrajectory,
<a name="l00153"></a>00153             (<span class="stringliteral">'configuration'</span>, <span class="stringliteral">'energy'</span>, <span class="stringliteral">'thermodynamic'</span>, <span class="stringliteral">'time'</span>, <span class="stringliteral">'auxiliary'</span>), 
<a name="l00154"></a>00154             0, <span class="keywordtype">None</span>, self.equilibrationSteps()), <span class="comment">#this last option makes it so none of the equilibration steps are output, consistent with Gulp</span>
<a name="l00155"></a>00155             <span class="comment"># Write restart data every time step.</span>
<a name="l00156"></a>00156             RestartTrajectoryOutput(self.i.restartFilename, 1),
<a name="l00157"></a>00157             LogOutput(self.i.logFilename, (<span class="stringliteral">'time'</span>, <span class="stringliteral">'energy'</span>), 0, <span class="keywordtype">None</span>) 
<a name="l00158"></a>00158             ]  
<a name="l00159"></a>00159     
<a name="l00160"></a>00160     <span class="keyword">def </span>_integrateNVE(self):
<a name="l00161"></a>00161         <span class="comment"># Do some equilibration steps</span>
<a name="l00162"></a>00162         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#5acab80c68beb2a2eaf7a01421a9789d">mmtkIntegrator</a>mmtkIntegrator(steps = self.equilibrationSteps(), actions = self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#15865427ee798c1993cdd2f52aa37daf">equilibration_actions</a>equilibration_actions)
<a name="l00163"></a>00163         <span class="comment"># Do some "production" steps.</span>
<a name="l00164"></a>00164         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#5acab80c68beb2a2eaf7a01421a9789d">mmtkIntegrator</a>mmtkIntegrator(steps = self.productionSteps(), actions = self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#40a46385f55982f9e0039022bdd2482a">output_actions</a>output_actions)
<a name="l00165"></a>00165         <span class="comment"># Close the trajectory.</span>
<a name="l00166"></a>00166         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#0b6bfd208e225967d4e45f1df86857a5">mmtkTrajectory</a>mmtkTrajectory.close()
<a name="l00167"></a>00167         
<a name="l00168"></a>00168     <span class="keyword">def </span>_integrateNVT(self):
<a name="l00169"></a>00169         <span class="comment"># Add thermostat </span>
<a name="l00170"></a>00170         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse.thermostat = NoseThermostat(self.i.sample.i.temperature)
<a name="l00171"></a>00171         <span class="comment"># Do some equilibration steps and rescaling velocities.</span>
<a name="l00172"></a>00172         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#5acab80c68beb2a2eaf7a01421a9789d">mmtkIntegrator</a>mmtkIntegrator(steps = self.equilibrationSteps(), actions = [VelocityScaler(self.i.sample.i.temperature, 
<a name="l00173"></a>00173             0.1*self.i.sample.i.temperature, 0, <span class="keywordtype">None</span>, 100)] + self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#15865427ee798c1993cdd2f52aa37daf">equilibration_actions</a>equilibration_actions)
<a name="l00174"></a>00174         <span class="comment"># Do some "production" steps.</span>
<a name="l00175"></a>00175         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#5acab80c68beb2a2eaf7a01421a9789d">mmtkIntegrator</a>mmtkIntegrator(steps = self.productionSteps(),
<a name="l00176"></a>00176                        actions = self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#40a46385f55982f9e0039022bdd2482a">output_actions</a>output_actions)
<a name="l00177"></a>00177         <span class="comment"># Close the trajectory.</span>
<a name="l00178"></a>00178         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#0b6bfd208e225967d4e45f1df86857a5">mmtkTrajectory</a>mmtkTrajectory.close()   
<a name="l00179"></a>00179         
<a name="l00180"></a>00180     <span class="keyword">def </span>_integrateNPT(self):
<a name="l00181"></a>00181         <span class="comment"># Add thermostat and barostat.</span>
<a name="l00182"></a>00182         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse.thermostat = NoseThermostat(self.i.sample.i.temperature)
<a name="l00183"></a>00183         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#63c773511c86ad41690fbffa74153f72">mmtkUniverse</a>mmtkUniverse.barostat = AndersenBarostat(self.i.sample.i.pressure)
<a name="l00184"></a>00184         <span class="comment"># Do some equilibration steps, rescaling velocities and resetting the</span>
<a name="l00185"></a>00185         <span class="comment"># barostat in regular intervals.</span>
<a name="l00186"></a>00186         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#5acab80c68beb2a2eaf7a01421a9789d">mmtkIntegrator</a>mmtkIntegrator(steps = self.equilibrationSteps(),
<a name="l00187"></a>00187             actions = [VelocityScaler(self.i.sample.i.temperature, 
<a name="l00188"></a>00188             0.1*self.i.sample.i.temperature, 0, <span class="keywordtype">None</span>, 100),
<a name="l00189"></a>00189             BarostatReset(100)] + self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#15865427ee798c1993cdd2f52aa37daf">equilibration_actions</a>equilibration_actions)
<a name="l00190"></a>00190         <span class="comment"># Do some "production" steps.</span>
<a name="l00191"></a>00191         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#5acab80c68beb2a2eaf7a01421a9789d">mmtkIntegrator</a>mmtkIntegrator(steps = self.productionSteps(),
<a name="l00192"></a>00192                        actions = self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#40a46385f55982f9e0039022bdd2482a">output_actions</a>output_actions)
<a name="l00193"></a>00193         <span class="comment"># Close the trajectory.</span>
<a name="l00194"></a>00194         self.<a class="code" href="classmolDynamics_1_1mmtk_1_1Mmtk_1_1Mmtk.html#0b6bfd208e225967d4e45f1df86857a5">mmtkTrajectory</a>mmtkTrajectory.close()
<a name="l00195"></a>00195         
<a name="l00196"></a>00196     <span class="keyword">def </span>integrate(self):
<a name="l00197"></a>00197         <span class="stringliteral">'''integrates an atomic system forward in time and produces a trajectory'''</span>
<a name="l00198"></a>00198         self._printErrorMessages()
<a name="l00199"></a>00199         self._setForcefield()
<a name="l00200"></a>00200         self._setInitialConditions()
<a name="l00201"></a>00201         self.createTrajectoryAndIntegrator()
<a name="l00202"></a>00202         <span class="keywordflow">if</span> self.i.ensemble==<span class="stringliteral">'nvt'</span>:
<a name="l00203"></a>00203             self._integrateNVT()
<a name="l00204"></a>00204         <span class="keywordflow">elif</span> self.i.ensemble==<span class="stringliteral">'npt'</span>:
<a name="l00205"></a>00205             self._integrateNPT()
<a name="l00206"></a>00206         <span class="keywordflow">elif</span> self.i.ensemble==<span class="stringliteral">'nve'</span>:
<a name="l00207"></a>00207             self._integrateNVE()
<a name="l00208"></a>00208         <span class="keywordflow">else</span>:
<a name="l00209"></a>00209             <span class="keywordflow">raise</span> Exception, <span class="stringliteral">'your ensemble is not suppported by mmtk'</span>
<a name="l00210"></a>00210         <span class="keywordflow">return</span>
<a name="l00211"></a>00211     
<a name="l00212"></a>00212     <span class="keyword">def </span>_printErrorMessages(self):
<a name="l00213"></a>00213         <span class="keywordflow">if</span> self.i.sampleFrequency &gt; self.i.timeStep*Units.fs:
<a name="l00214"></a>00214             <span class="keywordflow">print</span> <span class="stringliteral">'''Mmtk does not allow a different sample frequency than every timestep.</span>
<a name="l00215"></a>00215 <span class="stringliteral">            Write frequency will be set to every timestep.'''</span> 
<a name="l00216"></a>00216         <span class="keywordflow">if</span> self.i.dumpFrequency &gt; self.i.timeStep*Units.fs:
<a name="l00217"></a>00217             <span class="keywordflow">print</span> <span class="stringliteral">'''Mmtk does not allow a different dump frequency than every timestep.</span>
<a name="l00218"></a>00218 <span class="stringliteral">            Dump frequency will be set to every timestep.'''</span>
<a name="l00219"></a>00219         
<a name="l00220"></a>00220     <span class="keyword">def </span>restartIntegrate(self):
<a name="l00221"></a>00221         <span class="stringliteral">'''performs a restart of an md run'''</span>
<a name="l00222"></a>00222         self._printErrorMessages()
<a name="l00223"></a>00223         self._setForcefield()
<a name="l00224"></a>00224         self._setInitialConditions()
<a name="l00225"></a>00225         self.createRestartTrajectoryAndIntegrator()
<a name="l00226"></a>00226         <span class="keywordflow">if</span> self.i.ensemble==<span class="stringliteral">'nvt'</span>:
<a name="l00227"></a>00227             self._integrateNVT()
<a name="l00228"></a>00228         <span class="keywordflow">elif</span> self.i.ensemble==<span class="stringliteral">'npt'</span>:
<a name="l00229"></a>00229             self._integrateNPT()
<a name="l00230"></a>00230         <span class="keywordflow">elif</span> self.i.ensemble==<span class="stringliteral">'nve'</span>:
<a name="l00231"></a>00231             self._integrateNVE()
<a name="l00232"></a>00232         <span class="keywordflow">else</span>:
<a name="l00233"></a>00233             <span class="keywordflow">raise</span> Exception, <span class="stringliteral">'your ensemble is not suppported by mmtk'</span>
<a name="l00234"></a>00234         
<a name="l00235"></a>00235     <span class="keyword">def </span>execute(self):
<a name="l00236"></a>00236         <span class="stringliteral">'''writes out the files, starts the executable, and parses the output files'''</span>
<a name="l00237"></a>00237         self.printWarnings()
<a name="l00238"></a>00238         <span class="keywordflow">if</span> self.i.runType==<span class="stringliteral">'md'</span>:
<a name="l00239"></a>00239             self.integrate()
<a name="l00240"></a>00240         <span class="keywordflow">elif</span> self.i.runType==<span class="stringliteral">'restart md'</span>:
<a name="l00241"></a>00241             self.restart()
<a name="l00242"></a>00242         
<a name="l00243"></a>00243     <span class="keyword">def </span>getFinalConfiguration(self):
<a name="l00244"></a>00244         <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">"class %r must override 'execute'"</span> % self.__class__.__name__)
<a name="l00245"></a>00245     
<a name="l00246"></a>00246     <span class="keyword">def </span>getTrajectoryFile(self):
<a name="l00247"></a>00247         <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">"class %r must override 'execute'"</span> % self.__class__.__name__)
<a name="l00248"></a>00248     
<a name="l00249"></a>00249     <span class="keyword">def </span>getMaterialProperties(self):
<a name="l00250"></a>00250         <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">"class %r must override 'execute'"</span> % self.__class__.__name__)
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="comment"># main</span>
<a name="l00253"></a>00253 <span class="keywordflow">if</span> __name__ == <span class="stringliteral">'__main__'</span>:
<a name="l00254"></a>00254     <span class="keywordflow">pass</span>
<a name="l00255"></a>00255   
<a name="l00256"></a>00256 <span class="comment"># version</span>
<a name="l00257"></a>00257 __id__ = <span class="stringliteral">"$Id$"</span>
<a name="l00258"></a>00258  
<a name="l00259"></a>00259 <span class="comment"># End of file</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Sep 28 18:26:00 2007 for molDynamics by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
